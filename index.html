<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EMOTE – Emotion Detection</title>

<style>
body {
    margin: 0;
    height: 100vh;
    font-family: Arial, sans-serif;
    background: linear-gradient(120deg, #1d2671, #c33764);
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    background: rgba(0,0,0,0.65);
    padding: 35px;
    border-radius: 20px;
    width: 480px;
    text-align: center;
    color: white;
    box-shadow: 0 20px 45px rgba(0,0,0,0.7);
}

textarea {
    width: 100%;
    height: 110px;
    border-radius: 12px;
    border: none;
    padding: 12px;
    font-size: 15px;
    margin-top: 10px;
}

button {
    margin-top: 18px;
    padding: 12px 30px;
    font-size: 16px;
    border: none;
    border-radius: 25px;
    background: linear-gradient(45deg, #ff9800, #ff5722);
    color: white;
    font-weight: bold;
    cursor: pointer;
}

button:disabled {
    background: gray;
    cursor: not-allowed;
}

.result {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
}

.status {
    margin-top: 10px;
    font-size: 14px;
    color: #90ee90;
}
</style>
</head>

<body>

<div class="container">
    <h2>EMOTE</h2>
    <p>Emotion Detection using GoEmotions Dataset</p>

    <div class="status" id="status">Loading dataset...</div>

    <textarea id="inputText" placeholder="Enter a sentence to detect emotion..."></textarea>

    <button id="detectBtn" onclick="detectEmotion()" disabled>
        Detect Emotion
    </button>

    <div class="result" id="output"></div>
</div>

<script>
/* =====================================================
   AUTO-LOAD DATASET: goemotions_1.csv
===================================================== */
let dataset = [];

fetch("goemotions_1.csv")
    .then(response => {
        if (!response.ok) {
            throw new Error("Dataset not found");
        }
        return response.text();
    })
    .then(data => {
        const lines = data.trim().split(/\r?\n/);
        const headers = lines[0].toLowerCase().split(",");

        const textIndex = headers.indexOf("text");
        const emotionIndex = headers.indexOf("emotion");

        if (textIndex === -1 || emotionIndex === -1) {
            document.getElementById("status").innerText =
                "CSV must contain columns: text, emotion";
            return;
        }

        for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].split(",");
            if (cols.length > Math.max(textIndex, emotionIndex)) {
                dataset.push({
                    text: cols[textIndex].toLowerCase(),
                    emotion: cols[emotionIndex].toLowerCase()
                });
            }
        }

        document.getElementById("status").innerText =
            `Dataset loaded (${dataset.length} rows)`;
        document.getElementById("detectBtn").disabled = false;
    })
    .catch(error => {
        document.getElementById("status").innerText =
            "Failed to load goemotions_1.csv";
    });

/* =====================================================
   DATASET-ONLY SIMILARITY PREDICTION
===================================================== */
function predictEmotion(userText) {
    userText = userText.toLowerCase();
    const userWords = userText.split(/\s+/);

    let scores = {};

    dataset.forEach(row => {
        const rowWords = row.text.split(/\s+/);
        let match = 0;

        userWords.forEach(word => {
            if (rowWords.includes(word)) match++;
        });

        if (match > 0) {
            scores[row.emotion] = (scores[row.emotion] || 0) + match;
        }
    });

    let bestEmotion = "neutral";
    let maxScore = 0;

    for (let emotion in scores) {
        if (scores[emotion] > maxScore) {
            maxScore = scores[emotion];
            bestEmotion = emotion;
        }
    }

    return bestEmotion;
}

/* =====================================================
   MAIN FUNCTION
===================================================== */
function detectEmotion() {
    const input = document.getElementById("inputText").value.trim();

    if (input === "") {
        document.getElementById("output").innerHTML =
            "⚠️ Please enter a sentence";
        return;
    }

    const emotion = predictEmotion(input);

    document.getElementById("output").innerHTML =
        `Predicted Emotion: <b>${emotion.toUpperCase()}</b>`;
}
</script>

</body>
</html>
